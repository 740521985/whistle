<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Whistle Root CA</title>
<link href="/style/css/lib/bootstrap.css" rel="stylesheet" />
<style>
ul li {margin: 20px;}
.server-info {position: fixed; right: 10px; top: 10px;  -webkit-box-shadow: 0 5px 15px rgba(0, 0, 0, .5);
  box-shadow: 0 5px 15px rgba(0, 0, 0, .5); background-color: #fff; -webkit-background-clip: padding-box;
  background-clip: padding-box; border: 1px solid #999; border: 1px solid rgba(0, 0, 0, .2);
  border-radius: 6px; outline: 0; -webkit-box-shadow: 0 3px 9px rgba(0, 0, 0, .5);
  box-shadow: 0 3px 9px rgba(0, 0, 0, .5); padding: 15px;}
</style>
</head>
<body>
<ul>
	<li>直接下载：<a href="/cgi-bin/rootca">http://local.whistlejs.com/cgi-bin/rootca</a></li>
	<li>扫面二维码下载：<br><a href="/cgi-bin/rootca"><img src="/style/img/rootca.png" alt="http://local.whistlejs.com/cgi-bin/rootca" /></a></li>
	<li>安装根证书的方法，用浏览器下载安装：</li>
	<li>windows安装根证书参考: <a href="http://jingyan.baidu.com/article/5553fa820ab3ee65a23934d7.html" target="_blank">http://jingyan.baidu.com/article/5553fa820ab3ee65a23934d7.html</a></li>
	<li>mac安装根证书，点击根证书文件选择系统证书安装。</li>
	<li>手机安装根证书，用手机自带的默认浏览器下载，点击根证书文件按提示安装。</li>
	<li>
		<h5>服务器信息：</h5>
		<div class="about-server-info"></div>
	</li>
</ul>

<script src="/style/js/lib/base.js"></script>
<script>
	var curServerInfo;
	(function getServerInfo() {
		$.ajax({
			url: '/cgi-bin/server-info',
			dataType: 'json',
			timeout: 10000,
			success: handleServerInfo,
			complete: function() {
				setTimeout(getServerInfo, 5000);
			}
		});
	})();
	
	function handleServerInfo(serverInfo) {
		serverInfo = serverInfo.server;
		if (!curServerInfo || (serverInfo.port != curServerInfo.port || serverInfo.host != curServerInfo.host || 
				serverInfo.ipv4.sort().join() != curServerInfo.ipv4.sort().join())) {
			curServerInfo = serverInfo;
			render(serverInfo);
		}
	}
	
	function render(serverInfo) {
		var elem = $('#serverInfo');
		if (!elem.length) {
			elem = $('<div id="serverInfo" class="server-info"></div>').appendTo(document.body);
		}
		

		var html = ['<label>主机名: </label> ' + serverInfo.host, '<label>端口号: </label> ' + serverInfo.port];
		if (serverInfo.ipv4.length) {
			html.push('<label>本机IP:</label><br>' + serverInfo.ipv4.join('<br>'));
		}
		elem.html(html.join('<br>'));
	
	}
</script>
</body>
</html>